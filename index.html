<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>QUESTIONNAIRE AVANT CONSULTATION</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; color:#000; padding:20px; }
    h1 { text-align:center; text-transform:uppercase; font-weight:bold; }
    .question { margin:20px 0; }
    .drapeau-rouge { color:red; font-weight:bold; }
    .highlight { font-weight:bold; text-transform:uppercase; background:yellow; }
    #synthese { border:1px solid #ccc; padding:15px; margin-top:20px; background:#fff; }
    button { margin:10px; padding:10px 20px; }
  </style>
</head>
<body>

  <h1>QUESTIONNAIRE AVANT CONSULTATION</h1>

  <!-- Choix du motif -->
  <div id="choixMotif" class="question">
    <p><b>CHOISISSEZ VOTRE MOTIF :</b></p>
    <label><input type="radio" name="motif" value="fievre"> Fièvre</label><br>
    <label><input type="radio" name="motif" value="douleur"> Douleur</label><br>
    <label><input type="radio" name="motif" value="toux"> Toux</label><br>
    <label><input type="radio" name="motif" value="fatigue"> Fatigue</label><br>
    <label><input type="radio" name="motif" value="pertePoids"> Perte de poids</label><br>
    <label><input type="radio" name="motif" value="renouvellement"> Renouvellement traitement</label><br>
    <label><input type="radio" name="motif" value="autre"> Autre</label><br><br>
    <button onclick="demarrerQuestionnaire()">Commencer</button>
  </div>

  <!-- Zone des questions -->
  <div id="questionnaire"></div>

  <!-- Zone de synthèse -->
  <div id="synthese" style="display:none;"></div>
  <button id="copierBtn" style="display:none;" onclick="copierSynthese()">Copier la synthèse</button>

  <script>
    let motifChoisi = "";

    // Mini-algorithme mots-clés
    const redirections = {
      dermatologique: ["plaie","bouton","éruption","rougeur","démangeaison","allergie","érythème","acné","urticaire","psoriasis"],
      traumatologique: ["chute","entorse","fracture","douleur bras","douleur jambe","articulation","gonflement","hématome"],
      orl: ["oreille","otite","mal d’oreille","nez bouché","saignement nez","gorge","angine","amygdale"],
      ophtalmo: ["œil","yeux","conjonctivite","vision","trouble vue","rougeur œil","douleur œil"],
      cardio: ["cœur","palpitations","douleur thoracique","essoufflement","malaise","tension","hypertension"],
      digestif: ["ventre","diarrhée","constipation","reflux","nausée","vomissement","brûlure estomac"],
      uro: ["urine","urinaire","brûlure miction","cystite","sang urine","règles","gynécologique"],
      neuro: ["vertige","malaise","tremblement","convulsion","fourmillement","faiblesse","paralysie"],
      psycho: ["anxiété","angoisse","stress","dépression","insomnie","sommeil","nervosité"]
    };

    function demarrerQuestionnaire(){
      let motif = document.querySelector("input[name='motif']:checked");
      if(!motif){ alert("Sélectionnez un motif"); return; }
      motifChoisi = motif.value;
      document.getElementById("choixMotif").style.display="none";
      afficherQuestions(motifChoisi);
    }

    function afficherQuestions(motif){
      let q = document.getElementById("questionnaire");
      q.innerHTML = "";
      let html = "";

      /* ----------- FIÈVRE ----------- */
      if(motif==="fievre"){
        html += "<div class='question'><b>DURÉE :</b><br><input type='text' id='fievreDuree' placeholder='En jours'></div>";
        html += "<div class='question'><b>INTENSITÉ :</b><br><select id='fievreIntensite'><option>&lt;38°C</option><option>38-39°C</option><option>&gt;39°C</option></select></div>";
        html += "<div class='question'><b>SYMPTÔMES ASSOCIÉS :</b><br>"+
                "<label><input type='checkbox' value='Toux' class='assoc'> Toux</label><br>"+
                "<label><input type='checkbox' value='Mal de gorge' class='assoc'> Mal de gorge</label><br>"+
                "<label><input type='checkbox' value='Brûlures urinaires' class='assoc'> Brûlures urinaires</label><br>"+
                "<label><input type='checkbox' value='Douleurs abdominales' class='assoc'> Douleurs abdominales</label><br>"+
                "<label><input type='checkbox' value='Aucun' class='assoc'> Aucun</label></div>";
        html += "<div class='question'><b>SIGNES DE GRAVITÉ :</b><br>"+
                "<label><input type='checkbox' value='Raideur de nuque' class='dr'><span class='drapeau-rouge'> Raideur de nuque</span></label><br>"+
                "<label><input type='checkbox' value='Dyspnée' class='dr'><span class='drapeau-rouge'> Difficulté respiratoire</span></label><br>"+
                "<label><input type='checkbox' value='Altération conscience' class='dr'><span class='drapeau-rouge'> Altération de conscience</span></label><br>"+
                "<label><input type='checkbox' value='Éruption étendue' class='dr'><span class='drapeau-rouge'> Éruption cutanée étendue</span></label></div>";
      }

      /* ----------- DOULEUR ----------- */
      else if(motif==="douleur"){
        html += "<div class='question'><b>LOCALISATION :</b><br><select id='douleurLoc'><option>Bas ventre</option><option>Poitrine</option><option>Dos</option><option>Membre</option></select></div>";
        html += "<div class='question'><b>INTENSITÉ (0-10) :</b><br><input type='number' id='douleurInt' min='0' max='10'></div>";
        html += "<div class='question'><b>CONTEXTE :</b><br><input type='text' id='douleurContexte'></div>";
        html += "<div class='question'><b>SIGNES DE GRAVITÉ :</b><br>"+
                "<label><input type='checkbox' value='Douleur brutale intense' class='dr'><span class='drapeau-rouge'> Douleur brutale intense</span></label><br>"+
                "<label><input type='checkbox' value='Douleur + malaise' class='dr'><span class='drapeau-rouge'> Douleur avec malaise</span></label></div>";
      }

      /* ----------- TOUX ----------- */
      else if(motif==="toux"){
        html += "<div class='question'><b>DURÉE :</b><br><select id='touxDuree'><option>Aiguë &lt;3 semaines</option><option>Chronique &gt;8 semaines</option></select></div>";
        html += "<div class='question'><b>TYPE :</b><br><select id='touxType'><option>Sèche</option><option>Grasse</option></select></div>";
        html += "<div class='question'><b>EXPECTORATION :</b><br><input type='text' id='touxEx'></div>";
        html += "<div class='question'><b>SIGNES DE GRAVITÉ :</b><br>"+
                "<label><input type='checkbox' value='Hémoptysie' class='dr'><span class='drapeau-rouge'> Sang dans les crachats</span></label><br>"+
                "<label><input type='checkbox' value='Dyspnée au repos' class='dr'><span class='drapeau-rouge'> Dyspnée au repos</span></label></div>";
      }

      /* ----------- FATIGUE ----------- */
      else if(motif==="fatigue"){
        html += "<div class='question'><b>DURÉE :</b><br><input type='text' id='fatigueDuree'></div>";
        html += "<div class='question'><b>CONTEXTE :</b><br><input type='text' id='fatigueContexte'></div>";
        html += "<div class='question'><b>SIGNES DE GRAVITÉ :</b><br>"+
                "<label><input type='checkbox' value='Amaigrissement' class='dr'><span class='drapeau-rouge'> Amaigrissement</span></label><br>"+
                "<label><input type='checkbox' value='Sueurs nocturnes' class='dr'><span class='drapeau-rouge'> Sueurs nocturnes</span></label></div>";
      }

      /* ----------- PERTE DE POIDS ----------- */
      else if(motif==="pertePoids"){
        html += "<div class='question'><b>KILOS PERDUS :</b><br><input type='number' id='poidsKg'></div>";
        html += "<div class='question'><b>DURÉE :</b><br><input type='text' id='poidsDuree'></div>";
        html += "<div class='question'><b>APPÉTIT :</b><br><select id='poidsAppetit'><option>Conservé</option><option>Diminé</option><option>Augmenté</option></select></div>";
        html += "<div class='question'><b>SIGNES DE GRAVITÉ :</b><br>"+
                "<label><input type='checkbox' value='Perte >10%' class='dr'><span class='drapeau-rouge'> Perte >10% du poids</span></label><br>"+
                "<label><input type='checkbox' value='Sang selles' class='dr'><span class='drapeau-rouge'> Sang dans les selles</span></label></div>";
      }

      /* ----------- RENOUVELLEMENT ----------- */
      else if(motif==="renouvellement"){
        html += "<div class='question'><b>RENOUVELLEMENT TRAITEMENT :</b><br>"+
                "<label><input type='radio' name='renew' value='Oui'> Oui</label> "+
                "<label><input type='radio' name='renew' value='Non'> Non</label></div>";
      }

      /* ----------- AUTRE ----------- */
      else if(motif==="autre"){
        html += "<div class='question'><b>AUTRE MOTIF :</b><br><input type='text' id='autreTexte' placeholder='Décrivez en quelques mots'></div>";
      }

      html += "<button onclick='genererSynthese()'>Générer la synthèse</button>";
      q.innerHTML = html;
    }

    function genererSynthese(){
      let s = "<h2>QUESTIONNAIRE AVANT CONSULTATION</h2>";
      s += "<span class='highlight'>MOTIF :</span> <span style='background:yellow;'>"+motifChoisi+"</span><br>";

      if(motifChoisi==="fievre"){
        s += "<span class='highlight'>DURÉE :</span> <span style='background:yellow;'>"+document.getElementById("fievreDuree").value+" jours</span><br>";
        s += "<span class='highlight'>INTENSITÉ :</span> <span style='background:yellow;'>"+document.getElementById("fievreIntensite").value+"</span><br>";
      }

      else if(motifChoisi==="douleur"){
        s += "<span class='highlight'>LOCALISATION :</span> <span style='background:yellow;'>"+document.getElementById("douleurLoc").value+"</span><br>";
        s += "<span class='highlight'>INTENSITÉ :</span> <span style='background:yellow;'>"+document.getElementById("douleurInt").value+"/10</span><br>";
        s += "<span class='highlight'>CONTEXTE :</span> <span style='background:yellow;'>"+document.getElementById("douleurContexte").value+"</span><br>";
      }

      else if(motifChoisi==="toux"){
        s += "<span class='highlight'>DURÉE :</span> <span style='background:yellow;'>"+document.getElementById("touxDuree").value+"</span><br>";
        s += "<span class='highlight'>TYPE :</span> <span style='background:yellow;'>"+document.getElementById("touxType").value+"</span><br>";
        s += "<span class='highlight'>EXPECTORATION :</span> <span style='background:yellow;'>"+document.getElementById("touxEx").value+"</span><br>";
      }

      else if(motifChoisi==="fatigue"){
        s += "<span class='highlight'>DURÉE :</span> <span style='background:yellow;'>"+document.getElementById("fatigueDuree").value+"</span><br>";
        s += "<span class='highlight'>CONTEXTE :</span> <span style='background:yellow;'>"+document.getElementById("fatigueContexte").value+"</span><br>";
      }

      else if(motifChoisi==="pertePoids"){
        s += "<span class='highlight'>KILOS PERDUS :</span> <span style='background:yellow;'>"+document.getElementById("poidsKg").value+"</span><br>";
        s += "<span class='highlight'>DURÉE :</span> <span style='background:yellow;'>"+document.getElementById("poidsDuree").value+"</span><br>";
        s += "<span class='highlight'>APPÉTIT :</span> <span style='background:yellow;'>"+document.getElementById("poidsAppetit").value+"</span><br>";
      }

      else if(motifChoisi==="renouvellement"){
        let renew = document.querySelector("input[name='renew']:checked");
        s += "<span class='highlight'>RENOUVELLEMENT :</span> <span style='background:yellow;'>"+(renew?renew.value:"Non précisé")+"</span><br>";
      }

      else if(motifChoisi==="autre"){
        let texte = document.getElementById("autreTexte").value.trim();
        s += "<span class='highlight'>DESCRIPTION :</span> <span style='background:yellow;'>"+texte+"</span><br>";
        // recherche mot-clé
        let redir = "non reconnu";
        for(let cat in redirections){
          for(let mot of redirections[cat]){
            if(texte.toLowerCase().includes(mot)){ redir=cat; break; }
          }
          if(redir!=="non reconnu") break;
        }
        if(redir!=="non reconnu"){
          s += "<span class='drapeau-rouge'>Sous-questionnaire suggéré : "+redir.toUpperCase()+"</span><br>";
        }
      }

      // Drapeaux rouges cochés
      document.querySelectorAll(".dr:checked").forEach(el=>{
        s += "<span class='drapeau-rouge'>⚠️ DRAPEAU ROUGE : "+el.value+"</span><br>";
      });

      document.getElementById("synthese").innerHTML = s;
      document.getElementById("synthese").style.display="block";
      document.getElementById("copierBtn").style.display="inline-block";
    }

    function copierSynthese(){
      let texte = document.getElementById("synthese").innerText;
      navigator.clipboard.writeText(texte).then(()=>alert("Synthèse copiée !"));
    }
  </script>
</body>
</html>
