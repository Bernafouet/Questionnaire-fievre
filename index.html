<!doctype html><html lang="fr"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>QUESTIONNAIRE AVANT CONSULTATION</title>
<style>
:root{--red:#b91c1c;--redbg:#fee2e2;--bd:#e5e7eb;--mut:#6b7280;--hl:#fef08a}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f7f7f8;color:#111;padding:24px}
.card{background:#fff;border:1px solid var(--bd);border-radius:12px;max-width:880px;margin:0 auto 18px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
h1{margin:0 0 6px;font-size:26px} h2{margin:12px 0 8px;font-size:18px}
.muted{color:var(--mut);font-size:12px} .row{margin:10px 0}
.btn{border:1px solid #111;background:#111;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
.btn.secondary{background:#fff;color:#111}
input,textarea,select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:16px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px}
.tile{border:1px solid var(--bd);border-radius:12px;padding:14px;background:#fff}
.footer{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
.chips{display:flex;flex-wrap:wrap;gap:8px}.chip{border:1px solid #d1d5db;border-radius:999px;padding:8px 12px;background:#fff;cursor:pointer}
.chip.selected{background:#111;color:#fff;border-color:#111}
.flagbox{padding:12px;border-radius:12px;background:var(--redbg);border:1px solid #fecaca;margin:10px 0}
.flagtitle{font-weight:800;color:var(--red)} .flagreason{color:var(--red);font-weight:700}
.ok{padding:10px 12px;border-radius:12px;background:#e0f2fe;color:#075985;border:1px solid #bae6fd;margin:10px 0;font-weight:600}
.summary{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:12px}
.sline{margin:4px 0}.slabel{font-weight:800;text-transform:uppercase;background:var(--hl);padding:2px 6px;border-radius:4px}
.svalue{margin-left:4px}
</style></head><body>
<div class="card"><h1>QUESTIONNAIRE AVANT CONSULTATION</h1><div class="muted">Choisissez un motif. En cas d’urgence, appelez le 15.</div></div>

<div id="home" class="card">
  <h2>Motif de consultation</h2>
  <div class="grid">
    <div class="tile"><strong>Fièvre</strong><p class="muted">Durée, température, drapeaux.</p><button class="btn" onclick="start('fievre')">Commencer</button></div>
    <div class="tile"><strong>Douleur</strong><p class="muted">Localisation, intensité, drapeaux.</p><button class="btn" onclick="start('douleur')">Commencer</button></div>
    <div class="tile"><strong>Mal de tête</strong><p class="muted">Début, contexte, drapeaux.</p><button class="btn" onclick="start('cephalees')">Commencer</button></div>
    <div class="tile"><strong>Renouvellement</strong><p class="muted">Tolérance, mesures, intercurrents.</p><button class="btn" onclick="start('renouv')">Commencer</button></div>
  </div>
</div>

<div id="q" class="card" style="display:none"></div>
<div id="out" class="card" style="display:none"></div>

<script>
const MSSANTE_TO="nom.prenom@votre-cabinet.mssante.fr"; // <- à personnaliser
const $=id=>document.getElementById(id);
const list=a=>(a&&a.length)?a.map(x=>x.label).join(", "):"Aucun";
const esc=s=>String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
const lines=pairs=>pairs.map(([k,v])=>`<div class="sline"><span class="slabel">${k}</span> : <span class="svalue">${esc(v)}</span></div>`).join("");

const MODELS={
  fievre:{titre:"FIÈVRE",nodes:[
    ["info","INTRO","Ce questionnaire prépare votre consultation. En cas d’urgence, appelez le 15.","DUREE"],
    ["duration","DUREE","Depuis quand avez-vous de la fièvre ?","TMAX"],
    ["number","TMAX","Température maximale mesurée (°C)","EVOL"],
    ["single","EVOL","Comment évolue votre fièvre ?",["Continue","Par pics","Je ne sais pas"],"SYMPT"],
    ["multi","SYMPT","Avez-vous un de ces signes ?",[
      ["dyspnee","Essoufflement"],["douleur_thx","Douleur thoracique"],["raideur","Raideur de nuque"],
      ["purpura","Taches violettes"],["confusion","Somnolence / confusion"],["toux","Toux"],
      ["digestif","Vomissements / diarrhée"],["eruption","Éruption cutanée"]
    ],"FACTEURS"],
    ["multi","FACTEURS","Facteurs de risque",[
      ["grossesse","Grossesse"],["nourrisson","Âge < 3 mois"],["immuno","Immunodépression"],
      ["age","Âge > 75 ans"],["chronique","Maladie chronique"],["aucun","Aucun"]
    ],"TRAIT"],
    ["text","TRAIT","Traitements pris (nom, dose, efficacité)","FIN"]
  ],
  summary:A=>lines([
    ["MOTIF","Fièvre"],["DURÉE",A.DUREE||"(non précisée)"],["TEMPÉRATURE MAX",(A.TMAX??"(non précisée)")+" °C"],
    ["ÉVOLUTION",A.EVOL||"—"],["SIGNES ASSOCIÉS",list(A.SYMPT)],["FACTEURS DE RISQUE",list(A.FACTEURS)],["TRAITEMENTS",A.TRAIT||"Aucun"]
  ]),
  alerts:A=>{const r=[]; if(parseFloat(A.TMAX)>=40)r.push("Température ≥ 40 °C");
             if(any(A,["dyspnee","douleur_thx","raideur","purpura","confusion"]))r.push("Signes d’alerte associés");
             if(any(A,["grossesse","nourrisson","immuno"]))r.push("Situation à risque"); return r;}
  },

  douleur:{titre:"DOULEUR",nodes:[
    ["info","INTRO","Ce questionnaire prépare votre consultation douleur. En cas d’urgence, appelez le 15.","LOC"],
    ["single","LOC","Où est la douleur ?",["Tête","Poitrine","Abdomen","Dos","Membre","Autre"],"DUR"],
    ["duration","DUR","Depuis quand ?","INT"],
    ["number","INT","Intensité (0 à 10)","CAR"],
    ["multi","CAR","Caractère",["Brûlure","Piqûre","Crampes","Poids","Décharge","Pulsatile"],"SIG"],
    ["multi","SIG","Signes associés",[
      ["fievre","Fièvre"],["dyspnee","Essoufflement"],["deficit","Déficit neurologique"],["pc","Perte de connaissance"]
    ],"TRAIT"],
    ["text","TRAIT","Qu’avez-vous pris ? (nom, dose, effet)","FIN"]
  ],
  summary:A=>lines([
    ["MOTIF","Douleur"],["LOCALISATION",A.LOC||"—"],["DURÉE",A.DUR||"(non précisée)"],
    ["INTENSITÉ",(A.INT??"—")+"/10"],["CARACTÈRE",list(A.CAR)],["SIGNES ASSOCIÉS",list(A.SIG)],["TRAITEMENTS",A.TRAIT||"Aucun"]
  ]),
  alerts:A=>{const r=[]; if(parseFloat(A.INT)>=8)r.push("Douleur intense ≥ 8/10");
             if(any(A,["dyspnee","deficit","pc"]))r.push("Signes d’alerte associés");
             if(A.LOC==="Poitrine" && any(A,["dyspnee"]))r.push("Douleur thoracique + essoufflement"); return r;}
  },

  cephalees:{titre:"MAL DE TÊTE",nodes:[
    ["info","INTRO","Ce questionnaire prépare votre consultation pour céphalées. Appelez le 15 en cas d’urgence.","DEB"],
    ["single","DEB","Début de la douleur",["Brutal (coup de tonnerre)","Progressif","Récurrent (déjà connu)"],"CTX"],
    ["multi","CTX","Contexte",[
      ["fievre","Fièvre"],["raideur","Raideur de nuque"],["trauma","Traumatisme récent"],["grossesse","Grossesse/post-partum"],["anticoag","Anticoagulants"]
    ],"SIG"],
    ["multi","SIG","Signes associés",[
      ["deficit","Déficit neuro (faiblesse, parole/vision)"],["vomit","Vomissements en jet"],["photoph","Photophobie"]
    ],"TRAIT"],
    ["text","TRAIT","Traitements pris (nom, dose, effet)","FIN"]
  ],
  summary:A=>lines([["MOTIF","Mal de tête"],["DÉBUT",A.DEB||"—"],["CONTEXTE",list(A.CTX)],["SIGNES ASSOCIÉS",list(A.SIG)],["TRAITEMENTS",A.TRAIT||"Aucun"]]),
  alerts:A=>{const r=[]; if(A.DEB==="Brutal (coup de tonnerre)")r.push("Céphalée brutale");
             if(any(A,["raideur","trauma","grossesse","anticoag"]))r.push("Contexte à risque");
             if(any(A,["deficit"]))r.push("Signes neurologiques"); return r;}
  },

  renouv:{titre:"RENOUVELLEMENT D’ORDONNANCE",nodes:[
    ["info","INTRO","Ce questionnaire prépare le renouvellement. En cas d’urgence, appelez le 15.","TOL"],
    ["text","TOL","Tolérance / effets indésirables récents","MES"],
    ["text","MES","Mesures récentes si connues (TA, glycémie, poids, cholestérol…)","INT"],
    ["text","INT","Événements intercurrents","FIN"]
  ],
  summary:A=>lines([["MOTIF","Renouvellement d’ordonnance"],["TOLÉRANCE / EI",A.TOL||"—"],["MESURES RÉCENTES",A.MES||"—"],["ÉVÉNEMENTS INTERCURRENTS",A.INT||"—"]]),
  alerts:A=>{const r=[]; if((A.MES||"").match(/(TA|tension).*(2[0-9]{2}|1[8-9][0-9])/i))r.push("TA possiblement élevée");
             if((A.MES||"").match(/glyc(émie)?.*(>?\s?3[0-9]{2}|30)\b/i))r.push("Glycémie possiblement élevée");
             if((A.INT||"").match(/(douleur thoracique|dyspn(ée|ee)|malaise|syncope)/i))r.push("Symptômes intercurrents graves"); return r;}
  }
};

let MODEL=null,ANS={},alerts=[];
function start(key){ MODEL=MODELS[key]; ANS={}; alerts=[]; $('home').style.display='none'; $('q').style.display='block'; $('out').style.display='none'; go(MODEL.nodes[0][1]); }

function go(id){
  const n = MODEL.nodes.find(x=>x[1]===id);
  const box=$('q'); box.innerHTML=''; const h=document.createElement('h2'); h.textContent=labelOf(n); box.appendChild(h);
  if(n[0]==='info'){ box.insertAdjacentHTML('beforeend',`<div class="ok">${n[2]}</div>`); footer([{t:'Commencer',a:()=>go(n[3])},{t:'Changer de motif',a:home,sec:1}]); return; }
  const row=document.createElement('div'); row.className='row'; box.appendChild(row); let get=()=>null;
  if(n[0]==='duration'){row.innerHTML='<input id="d" placeholder="ex: 2 jours">'; get=()=>$('d').value;}
  if(n[0]==='number'){row.innerHTML='<input id="n" type="number" step="0.1">'; get=()=>parseFloat($('n').value);}
  if(n[0]==='single'){const s=document.createElement('select'); s.innerHTML='<option value="">— Sélectionner —</option>'+n[3].map(o=>`<option>${o}</option>`).join(''); row.appendChild(s); get=()=>s.value;}
  if(n[0]==='multi'){const wrap=document.createElement('div'); wrap.className='chips'; (n[3]||[]).forEach(o=>{const b=document.createElement('button'); b.type='button'; b.className='chip'; b.dataset.code=o[0]||o; b.textContent=o[1]||o; b.onclick=()=>b.classList.toggle('selected'); wrap.appendChild(b);}); row.appendChild(wrap); get=()=>Array.from(row.querySelectorAll('.chip.selected')).map(b=>({code:b.dataset.code,label:b.textContent}));}
  if(n[0]==='text'){const t=document.createElement('textarea'); t.rows=3; row.appendChild(t); get=()=>t.value.trim();}
  footer([{t:'Suivant',a:()=>{ANS[n[1]]=get(); if(n[0]==='text'||n[0]==='multi'||n[0]==='single'||n[0]==='number'||n[0]==='duration'){ const next=nextOf(n); if(next==='FIN') return summary(); else return go(next);} }},{t:'Changer de motif',a:home,sec:1}]);
}

function labelOf(n){ return (n[0]==='info')?'Information': (n[2]||'Question'); }
function nextOf(n){ return n[n.length-1]; }
function footer(btns){ const f=document.createElement('div'); f.className='footer'; btns.forEach(b=>{const el=document.createElement('button'); el.className='btn'+(b.sec?' secondary':''); el.textContent=b.t; el.onclick=b.a; f.appendChild(el);}); $('q').appendChild(f); }
function home(){ $('home').style.display='block'; $('q').style.display='none'; $('out').style.display='none'; }

function any(A,codes){ const all=[].concat(ANS.SYMPT||[],ANS.SIG||[],ANS.CTX||[],ANS.FACTEURS||[]); return all.some(o=>codes.includes(o.code)); }

function summary(){
  alerts = (MODEL.alerts?MODEL.alerts(ANS):[]) || [];
  let html='';
  if(alerts.length){ html+=`<div class="flagbox"><div class="flagtitle">⚠️ DRAPEAUX ROUGES</div>${alerts.map(a=>`<div class="flagreason">• ${esc(a)}</div>`).join('')}</div>`; }
  else html+='<div class="ok">Aucun drapeau rouge détecté.</div>';
  html+=`<div class="summary" id="syn">${MODEL.summary(ANS)}</div>
  <div class="footer">
    <button class="btn" onclick="copySyn()">Copier la synthèse</button>
    <button class="btn" onclick="sendMSS()">Envoyer via MSSanté</button>
    <button class="btn" onclick="home()">Changer de motif</button>
    <button class="btn" onclick="restart()">Recommencer</button>
  </div>`;
  $('out').innerHTML=html; $('out').style.display='block'; $('q').style.display='none';
}
function copySyn(){ navigator.clipboard.writeText($('syn').innerText).then(()=>alert("Synthèse copiée. Vous pouvez la coller dans Madeformed.")); }
function sendMSS(){ const body=(alerts.length?("Drapeaux rouges: "+alerts.join(", ")+"\n\n"):"")+$('syn').innerText+"\n\n— Questionnaire pré-consultation"; const url="mailto:"+encodeURIComponent(MSSANTE_TO)+"?subject="+encodeURIComponent("Pré-consultation — "+MODEL.titre)+"&body="+encodeURIComponent(body); location.href=url; }
function restart(){ $('out').style.display='none'; $('q').style.display='block'; const first=MODEL.nodes[0][1]; ANS={}; alerts=[]; go(first); }
</script>
</body></html>
